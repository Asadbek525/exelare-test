<p-table
  [value]="candidates()"
  [selection]="selectedCandidates()"
  (selectionChange)="onSelectionChange($event)"
  [rowHover]="true"
  dataKey="ConsIntID"
  cdkDropList
  [cdkDropListSortingDisabled]="true"
  [sortField]="sortField()"
  [sortOrder]="sortOrder()"
  (onSort)="onSort($event)"
>
  <!-- Table Header: row 1 = labels + sort, row 2 = filters -->
  <ng-template #header>
    <tr>
      <th style="width: 3rem">
        <p-checkbox
          [ngModel]="selectedCandidates().length === candidates().length && candidates().length > 0"
          [binary]="true"
          (ngModelChange)="onSelectionChange($event ? candidates() : [])"
        />
      </th>
      <th pSortableColumn="FirstName">
        <div class="flex items-center gap-2">
          FIRST NAME
          <p-sortIcon field="FirstName" />
        </div>
      </th>
      <th pSortableColumn="LastName">
        <div class="flex items-center gap-2">
          LAST NAME
          <p-sortIcon field="LastName" />
        </div>
      </th>
      <th pSortableColumn="Status">
        STATUS
        <p-sortIcon field="Status" />
      </th>
      <th pSortableColumn="JobTitle">
        JOB TITLE
        <p-sortIcon field="JobTitle" />
      </th>
      <th>PRIMARY SKILLS</th>
      <th pSortableColumn="City">
        LOCATION
        <p-sortIcon field="City" />
      </th>
      <th pSortableColumn="MobilePhone">
        MOBILE
        <p-sortIcon field="MobilePhone" />
      </th>
      <th pSortableColumn="EMail1">
        EMAIL
        <p-sortIcon field="EMail1" />
      </th>
    </tr>
    <tr class="table-view-filter-row">
      <th style="width: 3rem"></th>
      <th>
        <input
          pInputText
          type="text"
          placeholder="Filter..."
          class="w-full"
          pSize="small"
          [ngModel]="filterValues().firstName ?? ''"
          (ngModelChange)="onFilterChange('firstName', $event)"
        />
      </th>
      <th>
        <input
          pInputText
          type="text"
          placeholder="Filter..."
          class="w-full"
          pSize="small"
          [ngModel]="filterValues().lastName ?? ''"
          (ngModelChange)="onFilterChange('lastName', $event)"
        />
      </th>
      <th>
        <p-select
          [options]="statusOptions()"
          [ngModel]="filterValues().status ?? null"
          (ngModelChange)="onFilterChange('status', $event)"
          placeholder="All"
          size="small"
          class="w-full table-view-filter-select"
        />
      </th>
      <th>
        <input
          pInputText
          type="text"
          placeholder="Filter..."
          class="w-full"
          pSize="small"
          [ngModel]="filterValues().jobTitle ?? ''"
          (ngModelChange)="onFilterChange('jobTitle', $event)"
        />
      </th>
      <th>
        <input
          pInputText
          type="text"
          placeholder="Filter..."
          class="w-full"
          pSize="small"
          [ngModel]="filterValues().primarySkills ?? ''"
          (ngModelChange)="onFilterChange('primarySkills', $event)"
        />
      </th>
      <th>
        <input
          pInputText
          type="text"
          placeholder="Filter..."
          class="w-full"
          pSize="small"
          [ngModel]="filterValues().city ?? ''"
          (ngModelChange)="onFilterChange('city', $event)"
        />
      </th>
      <th>
        <input
          pInputText
          type="text"
          placeholder="Filter..."
          class="w-full"
          pSize="small"
          [ngModel]="filterValues().mobile ?? ''"
          (ngModelChange)="onFilterChange('mobile', $event)"
        />
      </th>
      <th>
        <input
          pInputText
          type="text"
          placeholder="Filter..."
          class="w-full"
          pSize="small"
          [ngModel]="filterValues().email ?? ''"
          (ngModelChange)="onFilterChange('email', $event)"
        />
      </th>
    </tr>
  </ng-template>

  <!-- Table Body -->
  <ng-template #body let-candidate>
    <tr cdkDrag [cdkDragData]="dragData(candidate)" app-candidate-row [candidate]="candidate">
      <div *cdkDragPlaceholder></div>
      <ng-template cdkDragPreview>
        <div class="cdk-drag-preview p-3 bg-white rounded-lg shadow-lg">
          <div class="flex items-center gap-2">
            <i class="pi pi-user"></i>
            <span class="font-semibold">{{ candidate.FullName }}</span>
          </div>
        </div>
      </ng-template>
    </tr>
  </ng-template>
</p-table>
