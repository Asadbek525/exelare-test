<p-table
  [value]="candidates()"
  [loading]="isLoading()"
  [selection]="selectedCandidates()"
  (selectionChange)="onSelectionChange($event)"
  [rowHover]="true"
  dataKey="ConsIntID"
  cdkDropList
  [cdkDropListSortingDisabled]="true"
  [lazy]="true"
  [filterDelay]="300"
  [rowTrackBy]="rowTrackByFn"
  (onLazyLoad)="loadCandidates($event)"
>
  <!-- Table Header: row 1 = labels + sort, row 2 = filters -->
  <ng-template #header>
    <tr>
      <th style="width: 3rem">
        <p-checkbox
          [ngModel]="selectedCandidates().length === candidates().length && candidates().length > 0"
          [binary]="true"
          (ngModelChange)="onSelectionChange($event ? candidates() : [])"
        />
      </th>
      <th pSortableColumn="FirstName">
        <div class="flex items-center gap-2">
          FIRST NAME
          <p-sortIcon field="FirstName" />
        </div>
      </th>
      <th pSortableColumn="LastName">
        <div class="flex items-center gap-2">
          LAST NAME
          <p-sortIcon field="LastName" />
        </div>
      </th>
      <th pSortableColumn="Status">
        STATUS
        <p-sortIcon field="Status" />
      </th>
      <th pSortableColumn="JobTitle">
        JOB TITLE
        <p-sortIcon field="JobTitle" />
      </th>
      <th>PRIMARY SKILLS</th>
      <th pSortableColumn="City">
        LOCATION
        <p-sortIcon field="City" />
      </th>
      <th pSortableColumn="MobilePhone">
        MOBILE
        <p-sortIcon field="MobilePhone" />
      </th>
      <th pSortableColumn="EMail1">
        EMAIL
        <p-sortIcon field="EMail1" />
      </th>
    </tr>
    <tr class="table-view-filter-row">
      <th style="width: 3rem"></th>
      <th>
        <p-columnFilter field="FirstName" matchMode="contains" [showMenu]="false">
          <ng-template pTemplate="filter" let-value let-filterCallback="filterCallback">
            <input
              type="text"
              pInputText
              placeholder="Filter..."
              class="w-full"
              pSize="small"
              [ngModel]="value"
              (ngModelChange)="filterCallback($event)"
            />
          </ng-template>
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter field="LastName" matchMode="contains" [showMenu]="false">
          <ng-template pTemplate="filter" let-value let-filterCallback="filterCallback">
            <input
              type="text"
              pInputText
              placeholder="Filter..."
              class="w-full"
              pSize="small"
              [ngModel]="value"
              (ngModelChange)="filterCallback($event)"
            />
          </ng-template>
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter field="Status" matchMode="equals" [showMenu]="false">
          <ng-template pTemplate="filter" let-value let-filterCallback="filterCallback">
            <p-select
              [options]="statusOptions"
              [ngModel]="value"
              (ngModelChange)="filterCallback($event)"
              placeholder="All"
              size="small"
              class="w-full table-view-filter-select"
            />
          </ng-template>
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter field="JobTitle" matchMode="contains" [showMenu]="false">
          <ng-template pTemplate="filter" let-value let-filterCallback="filterCallback">
            <input
              type="text"
              pInputText
              placeholder="Filter..."
              class="w-full"
              pSize="small"
              [ngModel]="value"
              (ngModelChange)="filterCallback($event)"
            />
          </ng-template>
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter field="PrimarySkills" matchMode="contains" [showMenu]="false">
          <ng-template pTemplate="filter" let-value let-filterCallback="filterCallback">
            <input
              type="text"
              pInputText
              placeholder="Filter..."
              class="w-full"
              pSize="small"
              [ngModel]="value"
              (ngModelChange)="filterCallback($event)"
            />
          </ng-template>
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter field="City" matchMode="contains" [showMenu]="false">
          <ng-template pTemplate="filter" let-value let-filterCallback="filterCallback">
            <input
              type="text"
              pInputText
              placeholder="Filter..."
              class="w-full"
              pSize="small"
              [ngModel]="value"
              (ngModelChange)="filterCallback($event)"
            />
          </ng-template>
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter field="MobilePhone" matchMode="contains" [showMenu]="false">
          <ng-template pTemplate="filter" let-value let-filterCallback="filterCallback">
            <input
              type="text"
              pInputText
              placeholder="Filter..."
              class="w-full"
              pSize="small"
              [ngModel]="value"
              (ngModelChange)="filterCallback($event)"
            />
          </ng-template>
        </p-columnFilter>
      </th>
      <th>
        <p-columnFilter field="EMail1" matchMode="contains" [showMenu]="false">
          <ng-template pTemplate="filter" let-value let-filterCallback="filterCallback">
            <input
              type="text"
              pInputText
              placeholder="Filter..."
              class="w-full"
              pSize="small"
              [ngModel]="value"
              (ngModelChange)="filterCallback($event)"
            />
          </ng-template>
        </p-columnFilter>
      </th>
    </tr>
  </ng-template>

  <!-- Table Body -->
  <ng-template #body let-candidate>
    <tr cdkDrag [cdkDragData]="dragData(candidate)" app-candidate-row [candidate]="candidate">
      <div *cdkDragPlaceholder></div>
      <ng-template cdkDragPreview>
        <div class="cdk-drag-preview p-3 bg-white rounded-lg shadow-lg">
          @if (isPartOfMultiDrag(candidate)) {
            <div class="flex items-center gap-3">
              <div
                class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm"
              >
                {{ multiDragCount(candidate) }}
              </div>
              <span class="font-semibold text-slate-700">Candidates Selected</span>
            </div>
          } @else {
            <div class="flex items-center gap-2">
              <i class="pi pi-user"></i>
              <span class="font-semibold">{{ candidate.FullName }}</span>
              @if (isPartOfMultiDrag(candidate)) {
                <span>{{ multiDragCount(candidate) }}</span>
              }
            </div>
          }
        </div>
      </ng-template>
    </tr>
  </ng-template>
</p-table>
